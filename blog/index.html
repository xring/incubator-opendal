<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Blog | Apache OpenDAL™</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://opendal.apache.org/blog"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="Blog | Apache OpenDAL™"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://opendal.apache.org/blog"><link data-rh="true" rel="alternate" href="https://opendal.apache.org/blog" hreflang="en"><link data-rh="true" rel="alternate" href="https://opendal.apache.org/blog" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache OpenDAL™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache OpenDAL™ Atom Feed"><link rel="stylesheet" href="/assets/css/styles.04f68a84.css">
<link rel="preload" href="/assets/js/runtime~main.ff2a4f1e.js" as="script">
<link rel="preload" href="/assets/js/main.b6189f03.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_S9Oh" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Apache OpenDAL (incubating)" class="themedImage_z9s7 themedImage--light_mvAv" height="32"><img src="/img/logo_dark.svg" alt="Apache OpenDAL (incubating)" class="themedImage_z9s7 themedImage--dark_InN9" height="32"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/overview">Docs</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">API</a><ul class="dropdown__menu"><li><a href="/docs/rust/opendal/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Rust Core</a></li><li><a href="/docs/nodejs/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Node.js Binding</a></li><li><a href="/docs/python/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Python Binding</a></li><li><a href="/docs/java/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Java Binding</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community/">Community</a><a class="navbar__item navbar__link" href="/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li><li><a href="https://www.apache.org/foundation/policies/conduct.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Code of Conduct</a></li></ul></div><a href="https://github.com/apache/incubator-opendal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://discord.gg/XQy8yGR2dg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Discord"></a><div class="searchBox_jDdq"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_Fvh5"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_x5K7 thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_IoTm margin-bottom--md">Recent posts</div><ul class="sidebarItemList_XJYL clean-list"><li class="sidebarItem_LEOT"><a class="sidebarItemLink_lBQy" href="/blog/owo-1">OwO #1: The v0.40 Release</a></li><li class="sidebarItem_LEOT"><a class="sidebarItemLink_lBQy" href="/blog/how-opendal-read-data">OpenDAL Internal: Data Reading</a></li><li class="sidebarItem_LEOT"><a class="sidebarItemLink_lBQy" href="/blog/opendal-access-data-freely">Apache OpenDAL(Incubating): Access Data Freely</a></li><li class="sidebarItem_LEOT"><a class="sidebarItemLink_lBQy" href="/blog/opendal-entered-apache-incubator">Way to Go: OpenDAL successfully entered Apache Incubator</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="OwO (Outcome, Working, Outlook) is our blog series where we share our current work status and future plans."><header><h2 class="title_OrKs" itemprop="headline"><a itemprop="url" href="/blog/owo-1">OwO #1: The v0.40 Release</a></h2><div class="container_M_sb margin-vert--md"><time datetime="2023-09-15T00:00:00.000Z" itemprop="datePublished">September 15, 2023</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Cy6B"><div class="avatar margin-bottom--sm"><a href="https://github.com/Xuanwo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/Xuanwo.png" alt="Xuanwo" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Xuanwo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Xuanwo</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>OwO (Outcome, Working, Outlook) is our blog series where we share our current work status and future plans.</p></blockquote><p>Hello! It&#x27;s been a while since our last update. We&#x27;ve been hard at work determining the optimal way to implement new features and improvements. We&#x27;re thrilled to announce that we&#x27;ll soon be releasing v0.40.</p><p>This post is structured into three main sections:</p><ul><li>Outcome (1st <code>O</code> in <code>OwO</code>): Summarizes the key accomplishments in the v0.40 release.</li><li>Working (the <code>w</code> in <code>OwO</code>): Provides an update on our current work.</li><li>Outlook (2nd <code>O</code> in <code>OwO</code>): Discusses what lies ahead for OpenDAL.</li></ul><h2 class="anchor anchorWithStickyNavbar_iyzW" id="outcome">Outcome<a href="#outcome" class="hash-link" aria-label="Direct link to Outcome" title="Direct link to Outcome">​</a></h2><p>OpenDAL now comprises four primary components:</p><ul><li>Core: The core library written in Rust.</li><li>Bindings: Language bindings powered by the OpenDAL Rust core.</li><li>Applications: Applications built using the OpenDAL Rust core.</li><li>Integrations: Collaborations with other projects.</li></ul><h3 class="anchor anchorWithStickyNavbar_iyzW" id="core">Core<a href="#core" class="hash-link" aria-label="Direct link to Core" title="Direct link to Core">​</a></h3><h4 class="anchor anchorWithStickyNavbar_iyzW" id="unifying-append-and-write-functions">Unifying Append and Write Functions<a href="#unifying-append-and-write-functions" class="hash-link" aria-label="Direct link to Unifying Append and Write Functions" title="Direct link to Unifying Append and Write Functions">​</a></h4><p>OpenDAL has supported <code>append</code> operations since <code>v0.36</code>. We&#x27;ve found, however, that this led to significant duplication between append and write. As a result, we&#x27;ve streamlined the two functionalities into a single write function. Our users can now:</p><div class="language-rust codeBlockContainer_gtpy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_a2DZ"><pre tabindex="0" class="prism-code language-rust codeBlock_HOtC thin-scrollbar"><code class="codeBlockLines_RLat"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> w </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> op</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">writer_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;test.txt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content_a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">content_b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_sWiR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nKsu" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fReV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Kruw"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This way, users can reuse the <code>Writer</code> in their own logic without handling <code>append</code> separately.</p><h4 class="anchor anchorWithStickyNavbar_iyzW" id="new-lister-api">New Lister API<a href="#new-lister-api" class="hash-link" aria-label="Direct link to New Lister API" title="Direct link to New Lister API">​</a></h4><p>To improve API consistency, we&#x27;ve made some adjustments to our listing functions. We&#x27;ve added <code>list</code> and <code>list_with</code> methods that perform single operations and renamed the original <code>list</code> to <code>lister</code> and <code>lister_with</code>.</p><div class="language-rust codeBlockContainer_gtpy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_a2DZ"><pre tabindex="0" class="prism-code language-rust codeBlock_HOtC thin-scrollbar"><code class="codeBlockLines_RLat"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Old API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> lister</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Lister</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> op</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dir&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// New API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> entries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Entry</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> op</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">list</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dir&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> lister</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Lister</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> op</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">lister</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dir&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_sWiR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nKsu" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fReV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Kruw"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This brings uniformity to our API offerings.</p><h4 class="anchor anchorWithStickyNavbar_iyzW" id="list-with-metakey">List With Metakey<a href="#list-with-metakey" class="hash-link" aria-label="Direct link to List With Metakey" title="Direct link to List With Metakey">​</a></h4><p>To speed up list operations, OpenDAL can now fetch and store metadata during the listing process. This eliminates the need for separate metadata calls:</p><div class="language-rust codeBlockContainer_gtpy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_a2DZ"><pre tabindex="0" class="prism-code language-rust codeBlock_HOtC thin-scrollbar"><code class="codeBlockLines_RLat"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> entries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Entry</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">list_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dir/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">metakey</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Metakey</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">ContentLength</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token class-name">Metakey</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">ContentType</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Use the metadata directly!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> meta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">Metadata</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> entries</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">metadata</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_sWiR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nKsu" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fReV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Kruw"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This makes metadata retrieval more intuitive.</p><h4 class="anchor anchorWithStickyNavbar_iyzW" id="buffered-writer">Buffered Writer<a href="#buffered-writer" class="hash-link" aria-label="Direct link to Buffered Writer" title="Direct link to Buffered Writer">​</a></h4><p>We&#x27;ve added general buffer support to optimize writing operations.</p><div class="language-rust codeBlockContainer_gtpy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_a2DZ"><pre tabindex="0" class="prism-code language-rust codeBlock_HOtC thin-scrollbar"><code class="codeBlockLines_RLat"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> w </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> op</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">writer_with</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;path/to/file&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">buffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><br></span></code></pre><div class="buttonGroup_sWiR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nKsu" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fReV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Kruw"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_iyzW" id="others">Others<a href="#others" class="hash-link" aria-label="Direct link to Others" title="Direct link to Others">​</a></h4><p>Other improvements in the core library can be found in our <a href="https://github.com/apache/incubator-opendal/blob/main/CHANGELOG.md" target="_blank" rel="noopener noreferrer">CHANGELOG</a>.</p><h3 class="anchor anchorWithStickyNavbar_iyzW" id="bindings">Bindings<a href="#bindings" class="hash-link" aria-label="Direct link to Bindings" title="Direct link to Bindings">​</a></h3><h4 class="anchor anchorWithStickyNavbar_iyzW" id="cpp">Cpp<a href="#cpp" class="hash-link" aria-label="Direct link to Cpp" title="Direct link to Cpp">​</a></h4><p><a href="https://github.com/apache/incubator-opendal/tree/main/bindings/cpp" target="_blank" rel="noopener noreferrer"><code>opendal-cpp</code></a> is ready for its first release! Welcome to check it out and give us some feedback.</p><h4 class="anchor anchorWithStickyNavbar_iyzW" id="haskell">Haskell<a href="#haskell" class="hash-link" aria-label="Direct link to Haskell" title="Direct link to Haskell">​</a></h4><p><a href="https://github.com/apache/incubator-opendal/tree/main/bindings/haskell" target="_blank" rel="noopener noreferrer"><code>opendal-hs</code></a> is ready for its first release! Welcome to check it out and give us some feedback.</p><h4 class="anchor anchorWithStickyNavbar_iyzW" id="java">Java<a href="#java" class="hash-link" aria-label="Direct link to Java" title="Direct link to Java">​</a></h4><p><a href="https://github.com/apache/incubator-opendal/tree/main/bindings/java" target="_blank" rel="noopener noreferrer"><code>opendal-java</code></a> enabled more available services in this release, allowing user to visit services like <code>redis</code> that not enabled by default in rust core. And <code>opendal-java</code> enabled blocking layer to allow users visit services like <code>s3</code> in blocking way.</p><p>Welcome to integrate <code>opendal-java</code> into your project and give us some feedback.</p><h4 class="anchor anchorWithStickyNavbar_iyzW" id="new-bindings">New bindings!<a href="#new-bindings" class="hash-link" aria-label="Direct link to New bindings!" title="Direct link to New bindings!">​</a></h4><ul><li><a href="https://github.com/apache/incubator-opendal/tree/main/bindings/dotnet" target="_blank" rel="noopener noreferrer"><code>opendal-dotnet</code></a></li><li><a href="https://github.com/apache/incubator-opendal/tree/main/bindings/php" target="_blank" rel="noopener noreferrer"><code>opendal-php</code></a></li></ul><h3 class="anchor anchorWithStickyNavbar_iyzW" id="applications">Applications<a href="#applications" class="hash-link" aria-label="Direct link to Applications" title="Direct link to Applications">​</a></h3><h4 class="anchor anchorWithStickyNavbar_iyzW" id="oay">oay<a href="#oay" class="hash-link" aria-label="Direct link to oay" title="Direct link to oay">​</a></h4><p><a href="https://github.com/apache/incubator-opendal/tree/main/bin/oay" target="_blank" rel="noopener noreferrer">oay</a> is OpenDAL Gateway that allows users to access OpenDAL services via existing protocols like <code>s3</code> and <code>webdav</code>. It works like a proxy that forwarding requests to OpenDAL services.</p><p>In this release, we implement basic <code>webdav</code> support. Users can convert any storage services to a webdav server!</p><h4 class="anchor anchorWithStickyNavbar_iyzW" id="oli">oli<a href="#oli" class="hash-link" aria-label="Direct link to oli" title="Direct link to oli">​</a></h4><p><a href="https://github.com/apache/incubator-opendal/tree/main/bin/oay" target="_blank" rel="noopener noreferrer">oli</a> is OpenDAL CLI that allows users to access storage services via CLI like <code>s3cmd</code> and <code>gcloud</code> does.</p><p>We fixed some experience issues in this release and improved some docs. Welcome to try it out and give us some feedback.</p><h3 class="anchor anchorWithStickyNavbar_iyzW" id="integrations">Integrations<a href="#integrations" class="hash-link" aria-label="Direct link to Integrations" title="Direct link to Integrations">​</a></h3><h4 class="anchor anchorWithStickyNavbar_iyzW" id="object_store">object_store<a href="#object_store" class="hash-link" aria-label="Direct link to object_store" title="Direct link to object_store">​</a></h4><p><a href="https://github.com/apache/incubator-opendal/tree/main/integrations/object_store" target="_blank" rel="noopener noreferrer">object_store</a> instead to implement <a href="https://github.com/apache/arrow-rs/tree/master/object_store" target="_blank" rel="noopener noreferrer"><code>object_store</code></a>&#x27;s trait over OpenDAL Operator so that users can use OpenDAL as a backend for <code>object_store</code>.</p><p><code>object_store</code> is mostly functional, but there are some edge use cases that OpenDAL has yet to support.</p><p>So far, this release hasn&#x27;t seen progress in this area; we are awaiting the resolution of the issue <a href="https://github.com/apache/incubator-opendal/issues/2762" target="_blank" rel="noopener noreferrer">Allow list paths that do not end with <code>/</code></a>.</p><h2 class="anchor anchorWithStickyNavbar_iyzW" id="working">Working<a href="#working" class="hash-link" aria-label="Direct link to Working" title="Direct link to Working">​</a></h2><p>We are working on the following things:</p><ul><li><code>object_store</code> support: Make <code>object_store</code> integration works and find a user for it.</li><li>Remove the <code>/</code> limitation for path, so we can list a path without ending with <code>/</code>.</li><li>Expand the <code>start-after</code> support to more services (Address <a href="https://github.com/apache/incubator-opendal/issues/2786" target="_blank" rel="noopener noreferrer">#2786</a>).</li></ul><h2 class="anchor anchorWithStickyNavbar_iyzW" id="outlook">Outlook<a href="#outlook" class="hash-link" aria-label="Direct link to Outlook" title="Direct link to Outlook">​</a></h2><p>We are exploring some innovative ideas:</p><ul><li><a href="https://github.com/apache/incubator-opendal/discussions/2951" target="_blank" rel="noopener noreferrer">OpenDAL REST/gRPC API</a>: A REST/gRPC Server for OpenDAL.</li><li><a href="https://github.com/apache/incubator-opendal/discussions/2953" target="_blank" rel="noopener noreferrer">OpenDAL Cache</a>: OpenDAL native cache libs that allowing users to access data more efficiently.</li><li><a href="https://github.com/apache/incubator-opendal/discussions/2952" target="_blank" rel="noopener noreferrer">OpenDAL File System</a>: A read-only file system that built upon OpenDAL in rust!</li><li><a href="https://github.com/apache/incubator-opendal/discussions/3042" target="_blank" rel="noopener noreferrer">kio-opendal</a>: A kio plugin powered by OpenDAL that allows users to visit different storage services in <a href="https://apps.kde.org/dolphin/" target="_blank" rel="noopener noreferrer">KDE Dolphin</a>.</li><li>gvfs-opendal: A gvfs plugin powered by OpenDAL that allows users to visit different storage services in <a href="https://wiki.gnome.org/Apps/Files" target="_blank" rel="noopener noreferrer">GNOME Files</a></li></ul><p>Feel free to join in the discussion!</p><h2 class="anchor anchorWithStickyNavbar_iyzW" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>This marks our first OpenDAL <code>OwO</code> post. We welcome your feedback.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_b0WQ padding--none margin-left--sm"><li class="tag_omRW"><a class="tag_uzug tagRegular_QVCb" href="/blog/tags/owo">owo</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="The first article will discuss OpenDAL&#x27;s most commonly used data reading function. I will start from the outermost interface and then gradually unfold according to the calling sequence of OpenDAL."><header><h2 class="title_OrKs" itemprop="headline"><a itemprop="url" href="/blog/how-opendal-read-data">OpenDAL Internal: Data Reading</a></h2><div class="container_M_sb margin-vert--md"><time datetime="2023-08-15T00:00:00.000Z" itemprop="datePublished">August 15, 2023</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Cy6B"><div class="avatar margin-bottom--sm"><a href="https://github.com/Xuanwo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/Xuanwo.png" alt="Xuanwo" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Xuanwo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Xuanwo</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>As the OpenDAL community continues to grow, new abstractions are constantly being added, which has brought some burdens to new contributors participating in development. Many maintainers hope to have a deeper understanding of OpenDAL&#x27;s internal implementation. At the same time, OpenDAL&#x27;s core design has not changed significantly for a long time, making it possible to write a series on internal implementation. I believe now is the time to write a series of articles on OpenDAL&#x27;s internal implementation, to explain from the maintainer&#x27;s perspective how OpenDAL is designed, implemented, and how it can be expanded. With the impending release of OpenDAL v0.40, I hope this series of articles will better help the community understand the past, master the present, and shape the future.</p><p>The first article will discuss OpenDAL&#x27;s most commonly used data reading function. I will start from the outermost interface and then gradually unfold according to the calling sequence of OpenDAL. Let&#x27;s get started!</p><h2 class="anchor anchorWithStickyNavbar_iyzW" id="overall-framework">Overall Framework<a href="#overall-framework" class="hash-link" aria-label="Direct link to Overall Framework" title="Direct link to Overall Framework">​</a></h2><p>Before starting to introduce the specific OpenDAL interface, let&#x27;s first get familiar with the OpenDAL project.</p><p><a href="https://github.com/apache/incubator-opendal" target="_blank" rel="noopener noreferrer">OpenDAL</a> is an Apache Incubator project aimed at helping users access data from various storage services in a unified, convenient, and efficient way. Its project <a href="https://opendal.apache.org/docs/vision" target="_blank" rel="noopener noreferrer">vision</a> is &quot;free access to data&quot;:</p><ul><li>Free from services: Any service can be accessed freely through native interfaces</li><li>Free from implementations: No matter how the underlying implementation is, it can be called in a unified way</li><li>Free to integrate: Able to freely integrate with various services and languages</li><li>Free to zero cost: Users don&#x27;t have to pay for features they don&#x27;t use</li></ul><p>On this philosophical foundation, OpenDAL Rust Core can be mainly divided into the following components:</p><ul><li>Operator: The outer interface exposed to users</li><li>Layers: Specific implementation of different middleware</li><li>Services: Specific implementation of different services</li></ul><p>From a macroscopic perspective, OpenDAL&#x27;s data reading call stack would look like this:</p><p><img loading="lazy" src="/assets/images/1-0b02956a3da2b4329eab11ea4779711c.png" width="1238" height="968" class="img_vY1S"></p><p>All Layers and Services have implemented a unified Accessor interface, erasing all type information when building the Operator. For the Operator, regardless of what services are used or how many middleware are added, all call logic is consistent. This design splits OpenDAL&#x27;s API into Public API and Raw API, where the Public API is directly exposed to users, providing convenient top-level interfaces, and Raw API is provided to OpenDAL internal developers, maintaining a unified internal interface and providing some convenient implementation.</p><h2 class="anchor anchorWithStickyNavbar_iyzW" id="operator">Operator<a href="#operator" class="hash-link" aria-label="Direct link to Operator" title="Direct link to Operator">​</a></h2><p>OpenDAL&#x27;s Operator API will adhere to a consistent calling paradigm as much as possible, reducing users&#x27; learning and usage costs. For example, OpenDAL offers the following APIs for <code>read</code>:</p><ul><li><code>op.read(path)</code>: Reads the entire content of the specified file</li><li><code>op.reader(path)</code>: Creates a Reader for streaming reading</li><li><code>op.read_with(path).range(1..1024)</code>: Reads file content using specified parameters, such as range</li><li><code>op.reader_with(path).range(1..1024)</code>: Creates a Reader for streaming reading with specified parameters</li></ul><p>It&#x27;s not hard to see that <code>read</code> is more like syntactic sugar, allowing users to quickly read files without considering various traits like <code>AsyncRead</code>. The <code>reader</code> provides more flexibility, implementing widely-used community traits like <code>AsyncSeek</code>, <code>AsyncRead</code>, allowing more flexible data reading. <code>read_with</code> and <code>reader_with</code> assist users in specifying various parameters in a more natural way through Future Builder functions.</p><p>The internal logic of the Operator would look like this:</p><p><img loading="lazy" src="/assets/images/2-3b83ca1ebfbdd77770566a80131846bd.png" width="1628" height="1006" class="img_vY1S"></p><p>Its main job is to encapsulate the interface for the user:</p><ul><li>Completing the construction of <code>OpRead</code>: the args for read operation.</li><li>Calling the <code>read</code> function provided by <code>Accessor</code></li><li>Wrapping the returned value as <code>Reader</code> and implementing interfaces like <code>AsyncSeek</code>, <code>AsyncRead</code>, etc., based on <code>Reader</code></li></ul><h2 class="anchor anchorWithStickyNavbar_iyzW" id="layers">Layers<a href="#layers" class="hash-link" aria-label="Direct link to Layers" title="Direct link to Layers">​</a></h2><p>A little secret here is that OpenDAL will automatically apply some Layers to the Service to implement some internal logic. As of the completion of this article, OpenDAL&#x27;s automatically added Layers include:</p><ul><li><code>ErrorContextLayer</code>: Injects context information, such as <code>scheme</code>, <code>path</code>, etc., into all returned errors of Operation</li><li><code>CompleteLayer</code>: Adds necessary capabilities to services, such as adding seek support to s3</li><li><code>TypeEraseLayer</code>: Implements type erasure, uniformly erasing associated types in <code>Accessor</code>, so users don&#x27;t need to carry generic parameters when using it</li></ul><p>Here, <code>ErrorContextLayer</code> and <code>TypeEraseLayer</code> are relatively simple and won&#x27;t be elaborated on. The focus is on <code>CompleteLayer</code>, aimed at adding <code>seek</code> or <code>next</code> support to OpenDAL&#x27;s returned <code>Reader</code> in a zero-cost way, so users don&#x27;t have to re-implement it. OpenDAL initially returned <code>Reader</code> and <code>SeekableReader</code> through different function calls in early versions, but the actual user feedback was not very good; almost all users were using <code>SeekableReader</code>. Therefore, OpenDAL subsequently added seek support as the first priority to the internal <code>Read</code> trait during the refactor:</p><div class="language-rust codeBlockContainer_gtpy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_a2DZ"><pre tabindex="0" class="prism-code language-rust codeBlock_HOtC thin-scrollbar"><code class="codeBlockLines_RLat"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">trait</span><span class="token plain"> </span><span class="token type-definition class-name">Read</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Unpin</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">Send</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token class-name">Sync</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Read bytes asynchronously.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">poll_read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Context</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">&#x27;_</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">u8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Poll</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">usize</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Seek asynchronously.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns `Unsupported` error if underlying reader doesn&#x27;t support seek.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">poll_seek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Context</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">&#x27;_</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">SeekFrom</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Poll</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">u64</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Stream [`Bytes`] from underlying reader.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Returns `Unsupported` error if underlying reader doesn&#x27;t support stream.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// This API exists for avoiding bytes copying inside async runtime.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// Users can poll bytes from underlying reader and decide when to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// read/consume them.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">poll_next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token keyword" style="color:#00009f">mut</span><span class="token plain"> </span><span class="token class-name">Context</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">&#x27;_</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Poll</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Option</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Bytes</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_sWiR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nKsu" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fReV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Kruw"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To implement a service&#x27;s reading capability in OpenDAL, one needs to implement this trait, which is an internal interface and will not be directly exposed to users. Among them:</p><ul><li><code>poll_read</code> is the most basic requirement; all services must implement this interface.</li><li>When the service natively supports <code>seek</code>, <code>poll_seek</code> can be implemented, and OpenDAL will correctly dispatch, such as local fs;</li><li>When the service natively supports <code>next</code>, meaning it returns streaming Bytes, <code>poll_next</code> can be implemented, like HTTP-based services, where the underlying layer is a TCP Stream, and hyper will encapsulate it as a bytes stream.</li></ul><p>Through the <code>Read</code> trait, OpenDAL ensures that all services can expose their native support capabilities as much as possible, thereby achieving efficient reading for different services.</p><p>Based on this trait, OpenDAL will complete according to the capabilities supported by each service:</p><ul><li>Both seek/next are supported: Direct return</li><li>No support for next: Encapsulate using <code>StreamableReader</code> to simulate next support</li><li>No support for seek: Encapsulate using <code>ByRangeSeekableReader</code> to simulate seek support</li><li>Neither seek/next supported: Encapsulate using both methods</li></ul><blockquote><p><code>ByRangeSeekableReader</code> mainly utilizes the service&#x27;s ability to support range read, dropping the current reader when the user seeks and initiating a new request at the specified location.</p></blockquote><p>OpenDAL exposes a unified Reader implementation through <code>CompleteLayer</code>, so users don&#x27;t have to worry about whether the underlying service supports seek; OpenDAL will always choose the optimal way to initiate the request.</p><h2 class="anchor anchorWithStickyNavbar_iyzW" id="services">Services<a href="#services" class="hash-link" aria-label="Direct link to Services" title="Direct link to Services">​</a></h2><p>After the completion of the Layers, it&#x27;s time to call the specific implementation of the Service. Here, the most common services <code>fs</code> and <code>s3</code> are used as examples to explain how data is read.</p><h3 class="anchor anchorWithStickyNavbar_iyzW" id="service-fs">Service fs<a href="#service-fs" class="hash-link" aria-label="Direct link to Service fs" title="Direct link to Service fs">​</a></h3><p><code>tokio::fs::File</code> implements <code>tokio::AsyncRead</code> and <code>tokio::AsyncSeek</code>. Using <code>async_compat::Compat</code>, we have transformed it into <code>futures::AsyncRead</code> and <code>futures::AsyncSeek</code>. Based on this, we provide a built-in function <code>oio::into_read_from_file</code> to transform it into a type that implements <code>oio::Read</code>.</p><p>There&#x27;s nothing particularly complex in the implementation of <code>oio::into_read_from_file</code>; read and seek are mostly calling the functions provided by the incoming File type. The tricky part is about the correct handling of seek and range: seeking to the right side of the range is allowed, and this will not cause an error, and reading will only return empty, but seeking to the left side of the range is illegal, and the Reader must return <code>InvalidInput</code> for proper upper-level handling.</p><blockquote><p>Interesting history: there was <a href="https://github.com/apache/incubator-opendal/issues/2717" target="_blank" rel="noopener noreferrer">an issue</a> in the initial implementation of this part, discovered during fuzz testing.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_iyzW" id="services-s3">Services s3<a href="#services-s3" class="hash-link" aria-label="Direct link to Services s3" title="Direct link to Services s3">​</a></h3><p>S3 is an HTTP-based service, and opendal provides a lot of HTTP-based wrappers to help developers reuse logic; they only need to build a request and return a well-constructed Body. OpenDAL Raw API encapsulates a set of reqwest-based interfaces, and the HTTP GET interface returns a <code>Response&lt;IncomingAsyncBody&gt;</code>:</p><div class="language-rust codeBlockContainer_gtpy theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_a2DZ"><pre tabindex="0" class="prism-code language-rust codeBlock_HOtC thin-scrollbar"><code class="codeBlockLines_RLat"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// IncomingAsyncBody carries the content returned by remote servers.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">IncomingAsyncBody</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// # TODO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// hyper returns `impl Stream&lt;Item = crate::Result&lt;Bytes&gt;&gt;` but we can&#x27;t</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// write the types in stable. So we will box here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// After [TAIT](https://rust-lang.github.io/rfcs/2515-type_alias_impl_trait.html)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// has been stable, we can change `IncomingAsyncBody` into `IncomingAsyncBody&lt;S&gt;`.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">oio</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Streamer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Option</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">u64</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumed</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chunk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Option</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">Bytes</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_sWiR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_nKsu" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_fReV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Kruw"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The stream contained in this body is the bytes stream returned by reqwest, and opendal implements content length checks and read support on this basis.</p><p>Here&#x27;s an extra note about a small pitfall with reqwest/hyper: reqwest and hyper do not check the returned content length, so an illegal server may return a data volume that does not match the expected content length instead of an error, leading to unexpected data behavior. OpenDAL specifically added checks here, returning <code>ContentIncomplete</code> when data is insufficient and <code>ContentTruncated</code> when data exceeds expectations, avoiding users receiving illegal data.</p><h2 class="anchor anchorWithStickyNavbar_iyzW" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>This article introduces from top to bottom how OpenDAL implements data reading:</p><ul><li>Operator is responsible for exposing user-friendly interfaces</li><li>Layers are responsible for completing the capabilities of the services</li><li>Services are responsible for the specific implementation of different services</li></ul><p>Throughout the entire chain, OpenDAL adheres as much as possible to the principle of zero cost, prioritizing the use of native service capabilities, then considering simulation through other methods, and finally returning unsupported errors. Through this three-tier design, users don&#x27;t need to understand the details of the underlying service, nor do they need to integrate different service SDKs to easily call <code>op.read(path)</code> to access data in any storage service.</p><p>This is: How <strong>OpenDAL</strong> read data freely!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_b0WQ padding--none margin-left--sm"><li class="tag_omRW"><a class="tag_uzug tagRegular_QVCb" href="/blog/tags/internal">internal</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="If you&#x27;re committed to building cloud-native, cross-cloud-first applications and services, or you want to support configurable storage backends to meet complex data access needs, or if you&#x27;re tired of juggling various SDKs and hoping for a unified abstraction and development experience, Apache OpenDAL (Incubating) will be your perfect partner."><header><h2 class="title_OrKs" itemprop="headline"><a itemprop="url" href="/blog/opendal-access-data-freely">Apache OpenDAL(Incubating): Access Data Freely</a></h2><div class="container_M_sb margin-vert--md"><time datetime="2023-07-07T00:00:00.000Z" itemprop="datePublished">July 7, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Cy6B"><div class="avatar margin-bottom--sm"><a href="https://github.com/PsiACE" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/PsiACE.png" alt="PsiACE" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/PsiACE" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">PsiACE</span></a></div></div></div></div><div class="col col--6 authorCol_Cy6B"><div class="avatar margin-bottom--sm"><a href="https://github.com/Xuanwo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/Xuanwo.png" alt="Xuanwo" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/Xuanwo" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Xuanwo</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>If you&#x27;re committed to building cloud-native, cross-cloud-first applications and services, or you want to support configurable storage backends to meet complex data access needs, or if you&#x27;re tired of juggling various SDKs and hoping for a unified abstraction and development experience, Apache OpenDAL (Incubating) will be your perfect partner.</p><p><img loading="lazy" alt="OpenDAL Arch" src="/assets/images/opendal-arch-a614dff17a53ecef1fdbedb43be31c13.png" width="3932" height="2662" class="img_vY1S"></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_b0WQ padding--none margin-left--sm"><li class="tag_omRW"><a class="tag_uzug tagRegular_QVCb" href="/blog/tags/announcement">announcement</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Apache OpenDAL(Incubating): Access Data Freely" href="/blog/opendal-access-data-freely"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="On February 27th, 2023, the OpenDAL project achieved a milestone by winning the approval to join the incubator of the Apache Software Foundation (ASF), the world&#x27;s leading open source software organization. On March 15th, the OpenDAL project was officially transferred to the Apache Software Foundation."><header><h2 class="title_OrKs" itemprop="headline"><a itemprop="url" href="/blog/opendal-entered-apache-incubator">Way to Go: OpenDAL successfully entered Apache Incubator</a></h2><div class="container_M_sb margin-vert--md"><time datetime="2023-03-16T00:00:00.000Z" itemprop="datePublished">March 16, 2023</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Cy6B"><div class="avatar margin-bottom--sm"><a href="https://github.com/PsiACE" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/PsiACE.png" alt="PsiACE" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/PsiACE" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">PsiACE</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="OpenDAL successfully entered Apache Incubator" src="/assets/images/opendal-entered-apache-879d5165e27d370849e904ef8d65be25.png" width="1876" height="799" class="img_vY1S"></p><p>On February 27th, 2023, the <a href="https://github.com/apache/incubator-opendal" target="_blank" rel="noopener noreferrer">OpenDAL</a> project achieved a milestone by winning the approval to join the incubator of the <a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer">Apache Software Foundation</a> (ASF), the world&#x27;s leading open source software organization. On March 15th, the OpenDAL project was officially transferred to the Apache Software Foundation.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_b0WQ padding--none margin-left--sm"><li class="tag_omRW"><a class="tag_uzug tagRegular_QVCb" href="/blog/tags/announcement">announcement</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Way to Go: OpenDAL successfully entered Apache Incubator" href="/blog/opendal-entered-apache-incubator"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" rel="noopener noreferrer" class="footerLogoLink_xaJP"><img src="/./img/incubator.svg" alt="Apache Software Foundation" class="themedImage_z9s7 themedImage--light_mvAv footer__logo" width="200"><img src="/./img/incubator.svg" alt="Apache Software Foundation" class="themedImage_z9s7 themedImage--dark_InN9 footer__logo" width="200"></a></div><div class="footer__copyright">Apache OpenDAL (incubating) is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF. <br><br> Copyright © 2022-2024, The Apache Software Foundation Apache OpenDAL, OpenDAL, Apache, Apache Incubator, the Apache feather, the Apache Incubator logo and the Apache OpenDAL project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ff2a4f1e.js"></script>
<script src="/assets/js/main.b6189f03.js"></script>
</body>
</html>